# Simulation code for "On the consistency of bootstrap for matching estimators"
This repository contains the simulation code used in the Biometrika revision to evaluate the use of bootstrap on bias-corrected matching estimator on two empirical designs:

- **LDW** (Lalonde/Dehejia–Wahba data): outcome `re78`, treatment `t`.
- **Shadish**: outcome `mathall`, treatment `vm`.

The pipeline runs Monte Carlo experiments on Slurm, merges per-task outputs, and produces CSV and LaTeX tables with coverage metrics.

---

## Repository layout
```
bmproject/
estimators.py
mc_runner_LDW.py
mc_runner_Shadish.py
postprocess_LDW.py
postprocess_Shadish.py
scripts/
run_mc_LDW_array.sbatch
run_mc_Shadish_array.sbatch
merge_LDW.sbatch
merge_Shadish.sbatch
postprocess_LDW.sbatch
postprocess_Shadish.sbatch
data/ # (not tracked) place input .feather files here
result/ # outputs: CSV / TeX / merged feather
requirements.txt
```
---

## Software environment

- Python 3.9+ with packages listed in `requirements.txt` (NumPy, pandas, SciPy, scikit-learn, pyarrow, tqdm, etc.).
- Optional: PyTorch is listed but **not** required by the runners.

Create and activate a virtual environment, then install dependencies:

```bash
module load Python                 # omit if not on a module-based cluster
python -m venv ~/venvs/BMproject
source ~/venvs/BMproject/bin/activate
python -m pip install --upgrade pip
pip install -r requirements.txt
```
You may reuse an existing venv if you already have one.

## Data

Large inputs are **not** tracked in the repo. Place the following files under `data/`:

- `data/exp_generated.feather`  (LDW): Simulated LaLonde data is generated by Athey et al (2021), and can be directly downloaded from https ://drive.google.com/drive/folders/1CCU1zuibrPOZHK6NAAAVrX5TKQZZOMTF.
- `data/shadish_generated.feather`  (Shadish): Simulated Shadish data is generated by lin et al (2023), and can be directly downloaded from


## How to run (Slurm)

You can submit jobs with `sbatch`. The workflow is: run array jobs → merge → postprocess.

### Option A — submit step by step

```bash
# LDW
sbatch scripts/run_mc_LDW_array.sbatch
sbatch scripts/merge_LDW.sbatch
sbatch scripts/postprocess_LDW.sbatch

# Shadish
sbatch scripts/run_mc_Shadish_array.sbatch
sbatch scripts/merge_Shadish.sbatch
sbatch scripts/postprocess_Shadish.sbatch
```





























